<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.junefw.infra.modules.member.MemberMpp">

    <resultMap id="resultMapObj" type="com.junefw.infra.modules.member.Member"></resultMap>

	<sql id = "selectCommon">
		 FROM 
		 	shop.infrmember a
		 WHERE 1=1
			<choose>
				<when test="shIfmmDelNy ==1">AND ifmmDelNy = 1</when>
				<when test="shIfmmDelNy ==0">AND ifmmDelNy = 0</when>
			</choose>
			<if test="shIfmmName != null and !shIfmmName.equals('')"> AND ifmmName LIKE concat('%',#{shIfmmName},'%')</if>
			<choose>
				<when test="shOption ==1">AND ifmmName LIKE concat('%',#{shValue},'%')</when>
				<when test="shOption ==2">AND ifmmId LIKE concat('%',#{shValue},'%')</when>
			</choose>
			<choose>
		<when test="shOptionDate == 1">AND a.regDateTime BETWEEN #{shDateStart} AND #{shDateEnd}</when>
		<when test="shOptionDate == 2">AND a.modDateTime BETWEEN #{shDateStart} AND #{shDateEnd}</when>
		<when test="shOptionDate == 3">AND a.ifmmDob BETWEEN #{shDateStart} AND #{shDateEnd}</when>
	</choose>
	
	</sql>
	<select id="selectList" resultMap="resultMapObj">
			SELECT 
				a.ifmmSeq
			    ,a.ifmmName
			    ,a.ifmmId
			    ,a.ifmmDelNy
			    ,a.ifmmDob
				<include refid="selectCommon"/>		
				limit #{startRnumForMysql},#{rowNumToShow} 	
						
	</select>
	
	<select id="selectOneCount" resultType="Integer">  <!-- Integer -->
			SELECT 
				count(*)
				<include refid="selectCommon"/>		
	</select>
	
	<insert id="insert">
			INSERT INTO infrMember (
				ifmmId
				,ifmmPassword
				,ifmmName
				<!-- ,ifmmEmailConsentNy
				,ifmmSmsConsentNy -->
				,ifmmDelNy
				,ifmmDob
				
				) values (
				#{ifmmId}
				,#{ifmmPassword}
				,#{ifmmName}
				<!-- ,#{ifmmEmailconsentNy}
				,#{ifmmSmsConsentNy} -->
				,0
				<choose>
				<when test="ifmmDob.equals('')">,NULL</when>
				<otherwise>,#{ifmmDob}</otherwise>
				</choose>
				
				
				)
	
				<!-- ,regIp
				,regSeq
				,regDevice
			 	,regDateTime
				,regDateTimesvr
				,modIp
				,modSeq
				,modDevice
			 	,modDateTime
				,modDateTimesvr
				
				,#{regIp}
				,#{regSeq}
				,#{regDevice}
				,#{regDateTime}
				,#{regDateTimesvr}
				,#{modIp}
				,#{modSeq}
				,#{modDevice}
				,#{modDateTime}
				,#{modDateTimesvr} -->
		
	<selectKey resultType="String" keyProperty="ifmmSeq" order="AFTER">
		SELECT last_insert_id()
	</selectKey>
	
	</insert>
	<insert id="insertEmail">
			INSERT INTO infrMemberEmail (
				ifmeEmailFull
				,ifmeDelNy
				) values (
				#{ifmeEmailFull}
				,0)
	<selectKey resultType="String" keyProperty="ifmeSeq,ifmmSeq" order="AFTER">
		SELECT last_insert_id()
	</selectKey>
	
	</insert>
	<insert id="insertAddress">
			INSERT INTO infrMemberAddress (
				ifmaAddress1
				,ifmaDelNy
				) values (
				#{ifmaAddress1}
				,0)
	<selectKey resultType="String" keyProperty="ifmaSeq,ifmmSeq" order="AFTER">
		SELECT last_insert_id()
	</selectKey>
	
	</insert>
	<insert id="insertPhone">
			INSERT INTO infrMemberPhone (
				ifmpNumber
				,ifmpDefaultNy
				,ifmpDelNy
				) values (
				#{ifmpNumber}
				,1
				,0)
	<selectKey resultType="String" keyProperty="ifmpSeq,ifmmSeq" order="AFTER">
		SELECT last_insert_id()
	</selectKey>
	
	</insert>
	
	<update id="update">
			UPDATE
				infrmember
			SET 
				ifmmName = #{ifmmName}
			WHERE 1=1
				AND ifmmSeq = #{ifmmSeq}
	</update>
		
	<select id="selectOne" resultMap ="resultMapObj">
			select 
				a.ifmmSeq
				,a.ifmmName
				a,ifmmId
				,a.ifmmDelNy
			 from 
				shop.infrmember a
			where 1=1
				and ifmmSeq = #{ifmmSeq}
	</select>
		<update id="updateDelete">
		UPDATE
			infrMember
		SET
			ifmmDelny = 1
		WHERE 1=1
					AND ifmmSeq = #{ifmmSeq}
	</update>
		<update id="Uelete">
		UPDATE
			infrMember
		SET
			ifmmDelny = 1
		WHERE 1=1
					AND ifmmSeq = #{ifmmSeq}
	</update>
	<delete id="delete">
		DELETE FROM 
			infrMember
		WHERE 1=1
				AND ifmmSeq = #{ifmmSeq}
	</delete>
	
</mapper>