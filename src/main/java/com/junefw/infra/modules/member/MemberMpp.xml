<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.junefw.infra.modules.member.MemberMpp">

    <resultMap id="resultMapObj" type="com.junefw.infra.modules.member.Member"></resultMap>

	<sql id = "selectCommon">
		 FROM 
		 	shop.infrmember a
		 WHERE 1=1
			<choose>
				<when test="shIfmmDelNy ==1">AND ifmmDelNy = 1</when>
				<when test="shIfmmDelNy ==0">AND ifmmDelNy = 0</when>
			</choose>
			<if test="shIfmmName != null and !shIfmmName.equals('')"> AND ifmmName LIKE concat('%',#{shIfmmName},'%')</if>
			<choose>
				<when test="shOption ==1">AND ifcgName LIKE concat('%',#{shValue},'%')</when>
			</choose>
	
	</sql>
	<select id="selectList" resultMap="resultMapObj">
			SELECT 
				a.ifmmSeq
			    ,a.ifmmName
			    ,a.ifmmDelNy
				<include refid="selectCommon"/>		
				limit #{startRnumForMysql},#{rowNumToShow} 	
	</select>
	
	<select id="selectOneCount" resultType="Integer">  <!-- Integer -->
			SELECT 
				count(*)
				<include refid="selectCommon"/>		
	</select>
	
	<insert id="insert">
			INSERT INTO infrMember (
				ifmmName
				,ifmmDelNy
				) values (
				#{ifmmName}
				,0
				)
	<selectKey resultType="String" keyProperty="fdcgSeq" order="AFTER">
		SELECT last_insert_id()
	</selectKey>
	</insert>
	
	
	<select id="selectOne" resultMap ="resultMapObj">
			select 
				a.ifmmSeq
				,a.ifmmName
		 	from 
				shop.infrmember a
			where 1=1
				and ifmmSeq = #{ifmmSeq}

	</select>
	
	<update id="update">
			UPDATE
				infrmember
			SET 
				ifmmName = #{ifmmName}
			WHERE 1=1
				AND ifmmSeq = #{ifmmSeq}
	</update>
		
	<select id="selectListCode" resultMap ="resultMapObj">
			select 
				a.ifmmSeq
				,a.ifmmName
		 	from 
				shop.infrmember a
			where 1=1
				and ifmmDelNy=0
			<if test="shIfmmSeq !=null and !shIfmmSeq.equals('')">AND ifmmSeq =#{shIfmmSeq}</if>
				<choose>
				<when test="shOption ==1">AND ifmmName LIKE concat('%',#{shValue},'%')</when>
			</choose>
			<!-- limit #{startRnumForMysql},#{rowNumToShow}  -->
			
	</select>
	<insert id="insertCode">
			INSERT INTO infrMember (
				ifmmName
				,ifmmDelNy
				,ifmmSeq
				,ifmmSeq
			) values (
				#{ifmmName}
				,0
				,#{ifmmSeq}
				,0
			)
	</insert>
	<select id="selectOneCode" resultMap ="resultMapObj">
			select 
				a.ifmmSeq
				,a.ifmmName
				,a.ifmmDelNy
			 from 
				shop.infrmember a
			where 1=1
				and ifmmSeq = #{ifmmSeq}
	</select>
	<select id="selectOneCodeCount" resultType ="Integer">
			select 
				count(*)
			from 
				shop.infrmember a
			where 1=1
				and ifmmDelNy=0
			<if test="shIfmmSeq !=null and !shIfmmSeq.equals('')">AND ifmmSeq =#{shIfmmSeq}</if>
				<choose>
				<when test="shOption ==1">AND ifmmName LIKE concat('%',#{shValue},'%')</when>
			</choose>
	</select>
	<update id="updateCode">
			UPDATE
				infrmember
			SET 
				ifmmName = #{ifmmName}
			WHERE 1=1
				AND ifmmSeq = #{ifmmSeq}
	</update>
</mapper>